
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Advanced Usage and Code Examples &#8212; Wolfram Client Library for Python 1.0.0.dev3 documentation</title>
    <link rel="stylesheet" href="../_static/wri.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <link rel="stylesheet" href="https://www.wolframcdn.com/fonts/source-sans-pro/1.0/global.css">
 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="public_api.html" title="API: Guide"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introduction to the Wolfram Client Library"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Wolfram Client Library for Python 1.0.0.dev3 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="toctree-wrapper compound">
</div>
<div class="section" id="advanced-usage-and-code-examples">
<h1>Advanced Usage and Code Examples<a class="headerlink" href="#advanced-usage-and-code-examples" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">all examples require the setting of the variable <strong>kernel_path</strong> to the path of a local Wolfram kernel.</p>
</div>
<div class="section" id="expression-representation">
<span id="adv-expression-representation"></span><h2>Expression Representation<a class="headerlink" href="#expression-representation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="contexts">
<h3>Contexts<a class="headerlink" href="#contexts" title="Permalink to this headline">¶</a></h3>
<p>In the Wolfram Language, symbols live in <a class="wl external reference" href="http://reference.wolfram.com/language/ref/Context.html" target="_blank">Context</a>, which serves as a namespace mechanism. Built-in functions belong to the <code class="docutils literal notranslate"><span class="pre">System`</span></code> context. By default, the context called <code class="docutils literal notranslate"><span class="pre">Global`</span></code> is associated to user-defined functions and new variables. More information about contexts can be found at <a class="reference external" href="http://reference.wolfram.com/language/tutorial/Contexts.html">tutorial/Contexts</a>.</p>
<p>Wolfram Language expressions are conveniently represented in Python using the attributes of the factory <a class="reference internal" href="../api/wolframclient.language.html#wolframclient.language.wl" title="wolframclient.language.wl"><code class="xref py py-data docutils literal notranslate"><span class="pre">wl</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wolframclient.language</span> <span class="k">import</span> <span class="n">wl</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">wl</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="go">Range[3]</span>
</pre></div>
</div>
<p>These attributes of the factory <a class="reference internal" href="../api/wolframclient.language.html#wolframclient.language.wl" title="wolframclient.language.wl"><code class="xref py py-data docutils literal notranslate"><span class="pre">wl</span></code></a> do not have a context attached:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">wl</span><span class="o">.</span><span class="n">myFunction</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="go">myFunction[1]</span>
</pre></div>
</div>
<p>The representation of a given expression using its string <a class="wl external reference" href="http://reference.wolfram.com/language/ref/InputForm.html" target="_blank">InputForm</a> is readable but ambiguous, since the context is resolved in the kernel during evaluation, and as such different kernels may return different results. See <a class="wl external reference" href="http://reference.wolfram.com/language/ref/$ContextPath.html" target="_blank">$ContextPath</a>.</p>
<p>On the other hand, in the <a class="wl external reference" href="http://reference.wolfram.com/language/tutorial/WXFFormatDescription.html" target="_blank">WXF</a> format, expressions are represented with their full names. Context must be fully specified for all symbols, the exception being the <code class="docutils literal notranslate"><span class="pre">System`</span></code> context, which can be omitted. As a consequence, in WXF a symbol with no context is always deserialized as a <code class="docutils literal notranslate"><span class="pre">System`</span></code> symbol.</p>
<p>The method <a class="reference internal" href="../api/wolframclient.evaluation.kernel.html#wolframclient.evaluation.kernel.kernelsession.WolframLanguageSession.evaluate" title="wolframclient.evaluation.kernel.kernelsession.WolframLanguageSession.evaluate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">evaluate()</span></code></a> accepts two types of input:</p>
<ul class="simple">
<li>Python strings are treated as a string <a class="wl external reference" href="http://reference.wolfram.com/language/ref/InputForm.html" target="_blank">InputForm</a>; as such, context is resolved during evaluation. User-defined functions are most of the time automatically created with the <code class="docutils literal notranslate"><span class="pre">Global`</span></code> context.</li>
<li>Serializable Python objects are serialized to WXF before evaluation; as such, context must be explicitly specified, except for <code class="docutils literal notranslate"><span class="pre">System`</span></code> symbols.</li>
</ul>
<div class="section" id="system-context">
<h4><code class="docutils literal notranslate"><span class="pre">System`</span></code> Context<a class="headerlink" href="#system-context" title="Permalink to this headline">¶</a></h4>
<p>In order to explicitly represent a system symbol in Python, the factory <a class="reference internal" href="../api/wolframclient.language.html#wolframclient.language.System" title="wolframclient.language.System"><code class="xref py py-data docutils literal notranslate"><span class="pre">System</span></code></a> can be used. First import it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wolframclient.language</span> <span class="k">import</span> <span class="n">System</span>
</pre></div>
</div>
<p>Create a Python object representing the built-in function <a class="wl external reference" href="http://reference.wolfram.com/language/ref/Classify.html" target="_blank">Classify</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">System</span><span class="o">.</span><span class="n">Classify</span>
<span class="go">System`Classify</span>
</pre></div>
</div>
</div>
<div class="section" id="global-context">
<h4><code class="docutils literal notranslate"><span class="pre">Global`</span></code> Context<a class="headerlink" href="#global-context" title="Permalink to this headline">¶</a></h4>
<p>User-defined functions and variables are associated to the <code class="docutils literal notranslate"><span class="pre">Global`</span></code> context by default. The factory <a class="reference internal" href="../api/wolframclient.language.html#wolframclient.language.Global" title="wolframclient.language.Global"><code class="xref py py-data docutils literal notranslate"><span class="pre">Global</span></code></a> can be used to represent those symbols:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wolframclient.language</span> <span class="k">import</span> <span class="n">Global</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Global</span><span class="o">.</span><span class="n">f</span>
<span class="go">Global`f</span>
</pre></div>
</div>
</div>
<div class="section" id="arbitrary-contexts">
<h4>Arbitrary Contexts<a class="headerlink" href="#arbitrary-contexts" title="Permalink to this headline">¶</a></h4>
<p>The factory <a class="reference internal" href="../api/wolframclient.language.html#wolframclient.language.wl" title="wolframclient.language.wl"><code class="xref py py-data docutils literal notranslate"><span class="pre">wl</span></code></a> can be used to build symbols with arbitrary context, as well as subcontexts:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">wl</span><span class="o">.</span><span class="n">Developer</span><span class="o">.</span><span class="n">PackedArrayQ</span>
<span class="go">Developer`PackedArrayQ</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">wl</span><span class="o">.</span><span class="n">Global</span><span class="o">.</span><span class="n">f</span>
<span class="go">Global`f</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">wl</span><span class="o">.</span><span class="n">System</span><span class="o">.</span><span class="n">Predict</span>
<span class="go">System`Predict</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">wl</span><span class="o">.</span><span class="n">MyContext</span><span class="o">.</span><span class="n">MySubContext</span><span class="o">.</span><span class="n">myFunction</span>
<span class="go">MyContext`MySubContext`myFunction</span>
</pre></div>
</div>
</div>
<div class="section" id="use-case">
<h4>Use Case<a class="headerlink" href="#use-case" title="Permalink to this headline">¶</a></h4>
<p>Create a new function using <a class="wl external reference" href="http://reference.wolfram.com/language/ref/InputForm.html" target="_blank">InputForm</a> evaluation that takes a list of strings and returns the longer ones. The Wolfram Language function <cite>max</cite> is:</p>
<div class="highlight-wl notranslate"><div class="highlight"><pre><span></span><span class="nv">max</span><span class="p">[</span><span class="nv">s</span><span class="o">:</span><span class="nb">List</span><span class="p">[</span><span class="nt">__String</span><span class="p">]]</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span><span class="nb">MaximalBy</span><span class="p">[</span><span class="nv">s</span><span class="p">,</span><span class="w"> </span><span class="nb">StringLength</span><span class="p">]</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">unicode_literals</span>

<span class="kn">from</span> <span class="nn">wolframclient.evaluation</span> <span class="k">import</span> <span class="n">WolframLanguageSession</span>
<span class="kn">from</span> <span class="nn">wolframclient.language</span> <span class="k">import</span> <span class="n">wl</span>
<span class="c1"># conveniently import Global as g</span>
<span class="hll"><span class="kn">from</span> <span class="nn">wolframclient.language</span> <span class="k">import</span> <span class="n">Global</span> <span class="k">as</span> <span class="n">g</span>
</span>

<span class="n">kernel_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Wolfram Desktop.app/Contents/MacOS/WolframKernel&#39;</span>
<span class="k">with</span> <span class="n">WolframLanguageSession</span><span class="p">(</span><span class="n">kernel_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="c1"># The function max belongs to context Global`</span>
<span class="hll">    <span class="n">session</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s1">&#39;max[s : List[__String]] := MaximalBy[s, StringLength]&#39;</span><span class="p">)</span>
</span>    <span class="c1"># Global`max is g.max in Python</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
    <span class="c1"># Evaluate the function on a Python list of strings</span>
<span class="hll">    <span class="n">res</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="s1">&#39;hello&#39;</span><span class="p">,</span> <span class="s1">&#39;darkness&#39;</span><span class="p">,</span> <span class="s1">&#39;my&#39;</span><span class="p">,</span> <span class="s1">&#39;old&#39;</span><span class="p">,</span> <span class="s1">&#39;friend&#39;</span><span class="p">]))</span>
</span>    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
<p>In that code, a simple replacement of <cite>g.max</cite> by <cite>wl.max</cite> shows that kernel no longer evaluates the input.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">it is important to understand that <a class="reference internal" href="../api/wolframclient.evaluation.kernel.html#wolframclient.evaluation.kernel.kernelsession.WolframLanguageSession.evaluate" title="wolframclient.evaluation.kernel.kernelsession.WolframLanguageSession.evaluate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">evaluate()</span></code></a> applied to a string is equivalent to evaluating <a class="wl external reference" href="http://reference.wolfram.com/language/ref/ToExpression.html" target="_blank">ToExpression</a> on top of the string input, and as such some context inference is performed. In this case the <cite>max</cite> function is actually <code class="docutils literal notranslate"><span class="pre">Global`max</span></code>, whereas when the Python object is passed to <a class="reference internal" href="../api/wolframclient.evaluation.kernel.html#wolframclient.evaluation.kernel.kernelsession.WolframLanguageSession.evaluate" title="wolframclient.evaluation.kernel.kernelsession.WolframLanguageSession.evaluate"><code class="xref py py-meth docutils literal notranslate"><span class="pre">evaluate()</span></code></a>, it is serialized to <a class="wl external reference" href="http://reference.wolfram.com/language/tutorial/WXFFormatDescription.html" target="_blank">WXF</a> first, which is strict in terms of symbol context. The only context that can be omitted is the <code class="docutils literal notranslate"><span class="pre">System`</span></code> context. As a consequence, any symbol without context is attached to the <code class="docutils literal notranslate"><span class="pre">System`</span></code> context; <cite>max</cite> is thus <code class="docutils literal notranslate"><span class="pre">System`max</span></code>, which is not defined.</p>
</div>
</div>
</div>
</div>
<div class="section" id="local-kernel-evaluation">
<span id="adv-local-evaluation"></span><h2>Local Kernel Evaluation<a class="headerlink" href="#local-kernel-evaluation" title="Permalink to this headline">¶</a></h2>
<p>The following sections provide executable demonstrations of the local kernel evaluation features of the client library.</p>
<div class="section" id="evaluation-methods">
<h3>Evaluation Methods<a class="headerlink" href="#evaluation-methods" title="Permalink to this headline">¶</a></h3>
<div class="section" id="synchronous">
<h4>Synchronous<a class="headerlink" href="#synchronous" title="Permalink to this headline">¶</a></h4>
<p>First initialize a session:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">wolframclient.evaluation</span> <span class="k">import</span> <span class="n">WolframLanguageSession</span>

<span class="n">kernel_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Wolfram Desktop.app/Contents/MacOS/WolframKernel&#39;</span>
<span class="n">session</span><span class="o">=</span><span class="n">WolframLanguageSession</span><span class="p">(</span><span class="n">kernel_path</span><span class="p">)</span>
<span class="n">session</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</pre></div>
</div>
<p>Expressions involving more than one function are usually evaluated with <a class="reference internal" href="../api/wolframclient.evaluation.html#wolframclient.evaluation.WolframLanguageSession.evaluate" title="wolframclient.evaluation.WolframLanguageSession.evaluate"><code class="xref py py-func docutils literal notranslate"><span class="pre">evaluate()</span></code></a>. Compute an integral:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">session</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s1">&#39;NIntegrate[Sqrt[x^2 + y^2 + z^2], {x, 0, 1}, {y, 0, 1}, {z, 0, 1}]&#39;</span><span class="p">)</span>
<span class="go">0.9605920064034617</span>
</pre></div>
</div>
<p>Messages may be issued during evaluation. By default, the above evaluation methods log error messages with severity <cite>warning</cite>. It usually results in the message being printed out. It is also possible to retrieve both the evaluation result and the messages, wrapped in an instance of <a class="reference internal" href="../api/wolframclient.evaluation.html#wolframclient.evaluation.result.WolframKernelEvaluationResult" title="wolframclient.evaluation.result.WolframKernelEvaluationResult"><code class="xref py py-class docutils literal notranslate"><span class="pre">WolframKernelEvaluationResult</span></code></a>, by using <a class="reference internal" href="../api/wolframclient.evaluation.html#wolframclient.evaluation.WolframLanguageSession.evaluate_wrap" title="wolframclient.evaluation.WolframLanguageSession.evaluate_wrap"><code class="xref py py-func docutils literal notranslate"><span class="pre">evaluate_wrap()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">eval</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">evaluate_wrap</span><span class="p">(</span><span class="s1">&#39;1/0&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">eval</span><span class="o">.</span><span class="n">result</span>
<span class="go">DirectedInfinity[]</span>
</pre></div>
</div>
<p>Messages are stored as tuples of two elements; the message name and the formatted message.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">eval</span><span class="o">.</span><span class="n">messages</span>
<span class="go">[(&#39;Power::infy&#39;, &#39;Infinite expression Infinity encountered.&#39;)]</span>
</pre></div>
</div>
</div>
<div class="section" id="asynchronous">
<h4>Asynchronous<a class="headerlink" href="#asynchronous" title="Permalink to this headline">¶</a></h4>
<div class="section" id="concurrent-future-api">
<h5>Concurrent Future API<a class="headerlink" href="#concurrent-future-api" title="Permalink to this headline">¶</a></h5>
<p>Some computations may take a significant time to finish, and the result might not be required immediately. Asynchronous evaluation is a way to start evaluations on a local kernel using a background task, without blocking the main Python execution. Asynchronous evaluation requires an instance of <a class="reference internal" href="../api/wolframclient.evaluation.html#wolframclient.evaluation.WolframLanguageFutureSession" title="wolframclient.evaluation.WolframLanguageFutureSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">WolframLanguageFutureSession</span></code></a> which contains the same method as its synchronous counterpart, except that returned values are wrapped into <a class="reference external" href="https://docs.python.org/3/library/concurrent.futures.html#concurrent.futures.Future" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">Future</span></code></a> objects.</p>
<p>Evaluate an artificially delayed code (using <a class="wl external reference" href="http://reference.wolfram.com/language/ref/Pause.html" target="_blank">Pause</a>), and print the time elapsed at each step:</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="hll"><span class="kn">from</span> <span class="nn">wolframclient.evaluation</span> <span class="k">import</span> <span class="n">WolframLanguageFutureSession</span>
</span><span class="kn">from</span> <span class="nn">wolframclient.utils.api</span> <span class="k">import</span> <span class="n">time</span>
<span class="c1"># Change the path to point to a local kernel.</span>
<span class="c1"># This value corresponds to the default path to a MacOS Wolfram Desktop kernel.</span>
<span class="n">kernel_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Wolfram Desktop.app/Contents/MacOS/WolframKernel&#39;</span>

<span class="hll"><span class="k">with</span> <span class="n">WolframLanguageFutureSession</span><span class="p">(</span><span class="n">kernel_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">future_session</span><span class="p">:</span>
</span>    <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting an evaluation delayed by 2 seconds.&#39;</span><span class="p">)</span>
<span class="hll">    <span class="n">future</span> <span class="o">=</span> <span class="n">future_session</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s1">&#39;Pause[2]; 1+1&#39;</span><span class="p">)</span>
</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After </span><span class="si">%.04f</span><span class="s1">s, the code is running in the background, Python execution continues.&#39;</span> <span class="o">%</span>
          <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">))</span>
    <span class="c1"># wait for up to 5 seconds.</span>
<span class="hll">    <span class="n">expr</span> <span class="o">=</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">(</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">5</span><span class="p">)</span>
</span>    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After </span><span class="si">%.02f</span><span class="s1">s, result was available. Kernel evaluation returned: </span><span class="si">%s</span><span class="s1">&#39;</span> 
      <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">,</span> <span class="n">expr</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<p>The standard output should display:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Starting an evaluation delayed by 2 seconds.
After 0.0069s, the code is running in the background, Python execution continues.
After 2.02s, result was available. Kernel evaluation returned: 2
</pre></div>
</div>
</div>
<div class="section" id="coroutine-and-asyncio-apis">
<h5>Coroutine and Asyncio APIs<a class="headerlink" href="#coroutine-and-asyncio-apis" title="Permalink to this headline">¶</a></h5>
<p>The <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> provides high-level concurrent code and asynchronous evaluation using coroutines and the <cite>async</cite>/<cite>await</cite> keywords. Asynchronous evaluation based on <a class="reference external" href="https://docs.python.org/3/library/asyncio.html#module-asyncio" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">asyncio</span></code></a> requires an instance of <a class="reference internal" href="../api/wolframclient.evaluation.html#wolframclient.evaluation.WolframLanguageAsyncSession" title="wolframclient.evaluation.WolframLanguageAsyncSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">WolframLanguageAsyncSession</span></code></a>, which methods are mostly coroutines.</p>
<p>Define a coroutine <cite>delayed_evaluation</cite> that artificially delays evaluation, using an asyncio sleep coroutine. Use this newly created coroutine to evaluate a first expression, wait for the coroutine to finish and evaluate the second:</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="hll"><span class="kn">import</span> <span class="nn">asyncio</span>
</span><span class="hll"><span class="kn">from</span> <span class="nn">wolframclient.evaluation</span> <span class="k">import</span> <span class="n">WolframLanguageAsyncSession</span>
</span><span class="kn">from</span> <span class="nn">wolframclient.utils.api</span> <span class="k">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">wolframclient.language</span> <span class="k">import</span> <span class="n">wl</span>
<span class="c1"># Change the path to point to a local kernel.</span>
<span class="c1"># This value corresponds to the default path to a MacOS Wolfram Desktop kernel.</span>
<span class="n">kernel_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Wolfram Desktop.app/Contents/MacOS/WolframKernel&#39;</span>

<span class="hll"><span class="k">async</span> <span class="k">def</span> <span class="nf">delayed_evaluation</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">async_session</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
</span><span class="hll">    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
</span><span class="hll">    <span class="k">return</span> <span class="k">await</span> <span class="n">async_session</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
</span>
<span class="hll"><span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span class="hll">    <span class="k">async</span> <span class="k">with</span> <span class="n">WolframLanguageAsyncSession</span><span class="p">(</span><span class="n">kernel_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">async_session</span><span class="p">:</span>
</span>        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting two tasks sequentially.&#39;</span><span class="p">)</span>
<span class="hll">        <span class="n">result1</span> <span class="o">=</span> <span class="k">await</span> <span class="n">delayed_evaluation</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">async_session</span><span class="p">,</span> <span class="n">wl</span><span class="o">.</span><span class="n">Range</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span>        <span class="c1"># Compute the Total of the previous evaluation result:</span>
<span class="hll">        <span class="n">result2</span> <span class="o">=</span> <span class="k">await</span> <span class="n">delayed_evaluation</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">async_session</span><span class="p">,</span> <span class="n">wl</span><span class="o">.</span><span class="n">Total</span><span class="p">(</span><span class="n">result1</span><span class="p">))</span>
</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After </span><span class="si">%.02f</span><span class="s1">s, both evaluations finished returning: </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&#39;</span>
            <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">,</span> <span class="n">result1</span><span class="p">,</span> <span class="n">result2</span><span class="p">))</span>

<span class="c1"># python 3.5+</span>
<span class="hll"><span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
</span><span class="hll"><span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span>
<span class="c1"># python 3.7+</span>
<span class="c1"># asyncio.run(main())</span>
</pre></div>
</td></tr></table></div>
<p>The timer printed in the standard output indicates that the total evaluation took roughly two seconds, which is the expected value for sequential evaluations:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Starting two tasks sequentially.
After 2.04s, both evaluations finished returning: [1, 2, 3], 6
</pre></div>
</div>
<p>When coroutines can be evaluated independently one from each other, it is convenient to run them in parallel. Start two independent coroutines in a concurrent fashion, and wait for the result:</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">from</span> <span class="nn">wolframclient.evaluation</span> <span class="k">import</span> <span class="n">WolframLanguageAsyncSession</span>
<span class="kn">from</span> <span class="nn">wolframclient.utils.api</span> <span class="k">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">wolframclient.language</span> <span class="k">import</span> <span class="n">wl</span>
<span class="c1"># Change the path to point to a local kernel.</span>
<span class="c1"># This value corresponds to the default path to a MacOS Wolfram Desktop kernel.</span>
<span class="n">kernel_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Wolfram Desktop.app/Contents/MacOS/WolframKernel&#39;</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">delayed_evaluation</span><span class="p">(</span><span class="n">delay</span><span class="p">,</span> <span class="n">async_session</span><span class="p">,</span> <span class="n">expr</span><span class="p">):</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">async_session</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">async</span> <span class="k">with</span> <span class="n">WolframLanguageAsyncSession</span><span class="p">(</span><span class="n">kernel_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">async_session</span><span class="p">:</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Running two tasks concurrently.&#39;</span><span class="p">)</span>
<span class="hll">        <span class="n">task1</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">delayed_evaluation</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">async_session</span><span class="p">,</span> <span class="s1">&#39;&quot;hello&quot;&#39;</span><span class="p">))</span>
</span><span class="hll">        <span class="n">task2</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">ensure_future</span><span class="p">(</span><span class="n">delayed_evaluation</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">async_session</span><span class="p">,</span> <span class="s1">&#39;&quot;world!&quot;&#39;</span><span class="p">))</span>
</span>        <span class="c1"># wait for the two tasks to finish</span>
<span class="hll">        <span class="n">result1</span> <span class="o">=</span> <span class="k">await</span> <span class="n">task1</span>
</span><span class="hll">        <span class="n">result2</span> <span class="o">=</span> <span class="k">await</span> <span class="n">task2</span>
</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;After </span><span class="si">%.02f</span><span class="s1">s, both evaluations finished returning: </span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">&#39;</span>
              <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">,</span> <span class="n">result1</span><span class="p">,</span> <span class="n">result2</span><span class="p">))</span>

<span class="c1"># python 3.5+</span>
<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>

<span class="c1"># python 3.7+</span>
<span class="c1"># asyncio.run(main())</span>
</pre></div>
</td></tr></table></div>
<p>The total evaluation took roughly one second, indicating that both delayed coroutines ran in parallel:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Running two tasks concurrently.
After 1.03s, both evaluations finished returning: hello, world!
</pre></div>
</div>
<p>In the examples shown, only one Wolfram kernel was used, which is a single-threaded process. Evaluating two computation-heavy Wolfram Language expressions in parallel will have no impact on performances. This requires more than one kernel, which is exactly what kernel pool was designed for.</p>
</div>
<div class="section" id="kernel-pool">
<h5>Kernel Pool<a class="headerlink" href="#kernel-pool" title="Permalink to this headline">¶</a></h5>
<p>A <a class="reference internal" href="../api/wolframclient.evaluation.html#wolframclient.evaluation.WolframEvaluatorPool" title="wolframclient.evaluation.WolframEvaluatorPool"><code class="xref py py-class docutils literal notranslate"><span class="pre">WolframEvaluatorPool</span></code></a> starts up a certain amount of evaluators and dispatch work load on them asynchronously. The pool is usable right after the first one has successfully started. Some may take more time to start and become available after a delay.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="hll"><span class="kn">from</span> <span class="nn">wolframclient.evaluation</span> <span class="k">import</span> <span class="n">WolframEvaluatorPool</span>
</span><span class="kn">from</span> <span class="nn">wolframclient.utils.api</span> <span class="k">import</span> <span class="n">time</span>
<span class="c1"># Change the path to point to a local kernel.</span>
<span class="c1"># This value corresponds to the default path to a MacOS Wolfram Desktop kernel.</span>
<span class="n">kernel_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Wolfram Desktop.app/Contents/MacOS/WolframKernel&#39;</span>

<span class="k">async</span> <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
<span class="hll">    <span class="k">async</span> <span class="k">with</span> <span class="n">WolframEvaluatorPool</span><span class="p">(</span><span class="n">kernel_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
</span>        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
<span class="hll">        <span class="n">tasks</span> <span class="o">=</span> <span class="p">[</span>
</span><span class="hll">            <span class="n">pool</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s1">&#39;Pause[1]&#39;</span><span class="p">)</span>
</span><span class="hll">            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</span><span class="hll">            <span class="p">]</span>
</span><span class="hll">        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span><span class="n">tasks</span><span class="p">)</span>
</span>        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done after </span><span class="si">%.02f</span><span class="s1">s, using up to </span><span class="si">%i</span><span class="s1"> kernels.&#39;</span> 
            <span class="o">%</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool</span><span class="p">)))</span>

<span class="c1"># python 3.5+</span>
<span class="n">loop</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">get_event_loop</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">run_until_complete</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>

<span class="c1"># python 3.7+</span>
<span class="c1"># asyncio.run(main())</span>
</pre></div>
</td></tr></table></div>
<p>Evaluation output shows that if more than one evaluator was started, the total time is less than ten seconds:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Done after 3.04s, using up to 4 kernels.
</pre></div>
</div>
</div>
<div class="section" id="parallel-evaluate">
<h5>parallel_evaluate<a class="headerlink" href="#parallel-evaluate" title="Permalink to this headline">¶</a></h5>
<p>It is possible to evaluate many expressions at once using <a class="reference internal" href="../api/wolframclient.evaluation.html#wolframclient.evaluation.parallel_evaluate" title="wolframclient.evaluation.parallel_evaluate"><code class="xref py py-func docutils literal notranslate"><span class="pre">parallel_evaluate()</span></code></a>. This method starts a kernel pool and uses it to compute expressions yield from an iterable object. The pool is then terminated.</p>
<p>Import the function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">wolframclient.evaluation</span> <span class="k">import</span> <span class="n">parallel_evaluate</span>
</pre></div>
</div>
<p>Specify the path of a target kernel:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">kernel_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Wolfram Desktop.app/Contents/MacOS/WolframKernel&#39;</span>
</pre></div>
</div>
<p>Build a list of ten delayed <a class="wl external reference" href="http://reference.wolfram.com/language/ref/$ProcessID.html" target="_blank">$ProcessID</a>, which returns the kernel process identified (<cite>pid</cite>) after one second:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">expressions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Pause[1]; $ProcessID&#39;</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]</span>
</pre></div>
</div>
<p>Evaluate in parallel and get back a list of ten values <cite>pid</cite>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">parallel_evaluate</span><span class="p">(</span><span class="n">kernel_path</span><span class="p">,</span> <span class="n">expressions</span><span class="p">)</span>
<span class="go">[72094, 72098, 72095, 72096, 72099, 72097, 72094, 72098, 72095, 72096]</span>
</pre></div>
</div>
<p>The result varies but the pattern remains the same – namely, at least one process was started, and each process is eventually used more than once.</p>
</div>
</div>
</div>
<div class="section" id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Permalink to this headline">¶</a></h3>
<p>Logging is often an important part of an application. The library relies on the standard <a class="reference external" href="https://docs.python.org/3/library/logging.html#module-logging" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">logging</span></code></a> module, and exposes various methods to control the level of information logged.</p>
<p>The first level of control is through the logging module itself. The Python library logs at various levels. Set up a basic configuration for the logging module to witness some messages in the standard output:</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">wolframclient.evaluation</span> <span class="k">import</span> <span class="n">WolframLanguageSession</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="hll"><span class="c1"># set the root level to INFO</span>
</span><span class="hll"><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span>
<span class="c1"># TODO: Change this value with a valid local path to a Wolfram Kernel.</span>
<span class="n">kernel_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Wolfram Desktop.app/Contents/MacOS/WolframKernel&#39;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">WolframLanguageSession</span><span class="p">(</span><span class="n">kernel_path</span><span class="p">)</span>
    <span class="c1"># this will trigger some log messages with the process ID, the sockets</span>
    <span class="c1"># address and the startup timer.</span>
    <span class="n">session</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
    <span class="c1"># Warning: Infinite expression Infinity encountered.</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s1">&#39;1/0&#39;</span><span class="p">)</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">session</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
</pre></div>
</td></tr></table></div>
<p>The standard output should display:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>INFO:wolframclient.evaluation.kernel.kernelsession:Kernel receives commands from socket: &lt;Socket: host=127.0.0.1, port=63471&gt;
INFO:wolframclient.evaluation.kernel.kernelsession:Kernel writes evaluated expressions to socket: &lt;Socket: host=127.0.0.1, port=63472&gt;
INFO:wolframclient.evaluation.kernel.kernelsession:Kernel process started with PID: 37169
INFO:wolframclient.evaluation.kernel.kernelsession:Kernel is ready. Startup took 1.54 seconds.
WARNING:wolframclient.evaluation.kernel.kernelsession:Infinite expression Infinity encountered.
</pre></div>
</div>
<p>It is also possible to log from within the kernel. This feature is disabled by default. When initializing a <a class="reference internal" href="../api/wolframclient.evaluation.html#wolframclient.evaluation.WolframLanguageSession" title="wolframclient.evaluation.WolframLanguageSession"><code class="xref py py-class docutils literal notranslate"><span class="pre">WolframLanguageSession</span></code></a>, the parameter <cite>kernel_loglevel</cite> can be specified with one of the following values to activate kernel logging: <code class="xref py py-class docutils literal notranslate"><span class="pre">logging.DEBUG</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">logging.INFO</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">logging.WARNING</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">logging.ERROR</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">if a WolframLanguageSession is initialized with the default <cite>kernel_loglevel</cite> (i.e: <code class="xref py py-class docutils literal notranslate"><span class="pre">logging.NOTSET</span></code>), kernel logging is disable for the session, and it is not possible to activate it afterward.</p>
</div>
<p>From the Wolfram Language, it is possible to issue log messages using one of the following functions, given with its signature:</p>
<div class="highlight-wl notranslate"><div class="highlight"><pre><span></span><span class="c">(* Sends a log message to Python with a given log level *)</span><span class="w"></span>
<span class="nv">ClientLibrary`debug</span><span class="p">[</span><span class="nt">args__</span><span class="p">]</span><span class="w"></span>
<span class="nv">ClientLibrary`info</span><span class="p">[</span><span class="nt">args__</span><span class="p">]</span><span class="w"></span>
<span class="nv">ClientLibrary`warn</span><span class="p">[</span><span class="nt">args__</span><span class="p">]</span><span class="w"></span>
<span class="nv">ClientLibrary`error</span><span class="p">[</span><span class="nt">args__</span><span class="p">]</span><span class="w"></span>
</pre></div>
</div>
<p>The log level of the kernel is independent of the Python one. The following functions can be used to restrict the amount of log data sent by the kernel:</p>
<div class="highlight-wl notranslate"><div class="highlight"><pre><span></span><span class="c">(* Sends only messages of a given level and above *)</span><span class="w"></span>
<span class="nv">ClientLibrary`SetDebugLogLevel</span><span class="p">[]</span><span class="w"></span>
<span class="nv">ClientLibrary`SetInfoLogLevel</span><span class="p">[]</span><span class="w"></span>
<span class="nv">ClientLibrary`SetWarnLogLevel</span><span class="p">[]</span><span class="w"></span>
<span class="nv">ClientLibrary`SetErrorLogLevel</span><span class="p">[]</span><span class="w"></span>
<span class="c">(* Sends no message at all *)</span><span class="w"></span>
<span class="nv">ClientLibrary`DisableKernelLogging</span><span class="p">[]</span><span class="w"></span>
</pre></div>
</div>
<p>Control the log level at both the Python and the kernel levels:</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">wolframclient.evaluation</span> <span class="k">import</span> <span class="n">WolframLanguageSession</span>
<span class="kn">import</span> <span class="nn">logging</span>

<span class="c1"># set the Python root logger level to INFO</span>
<span class="hll"><span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
</span>
<span class="c1"># TODO: Change this value with a valid local path to a Wolfram Kernel.</span>
<span class="n">kernel_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Wolfram Desktop.app/Contents/MacOS/WolframKernel&#39;</span>

<span class="c1"># Start a new session, with kernel logging activated and log level set to INFO.</span>
<span class="k">with</span> <span class="n">WolframLanguageSession</span><span class="p">(</span><span class="n">kernel_path</span><span class="p">,</span> <span class="n">kernel_loglevel</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="c1"># This message is printed</span>
<span class="hll">    <span class="n">session</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s1">&#39;ClientLibrary`info[&quot;ON -- Example message printed from the kernel </span><span class="se">\</span>
</span><span class="hll"><span class="s1">with log level INFO --&quot;]&#39;</span><span class="p">)</span>
</span>    <span class="c1"># This one is not because its level is debug. </span>
<span class="hll">    <span class="n">session</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s1">&#39;ClientLibrary`debug[&quot;OFF -- Debug message.&quot;]&#39;</span><span class="p">)</span>
</span>    
    <span class="c1"># Disable logging from the kernel side</span>
<span class="hll">    <span class="n">session</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s1">&#39;ClientLibrary`DisableKernelLogging[]&#39;</span><span class="p">)</span>
</span>    <span class="c1"># These messages will not be sent to Python.</span>
<span class="hll">    <span class="n">session</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s1">&#39;ClientLibrary`fatal[&quot;OFF -- Fatal message. Not printed&quot;]&#39;</span><span class="p">)</span>
</span><span class="hll">    <span class="n">session</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="s1">&#39;ClientLibrary`info[&quot;OFF -- End of kernel evaluation. Not printed&quot;]&#39;</span><span class="p">)</span>
</span></pre></div>
</td></tr></table></div>
</div>
</div>
<div class="section" id="extending-wxf-parsing-writing-a-wxfconsumer">
<h2>Extending WXF Parsing: Writing a WXFConsumer<a class="headerlink" href="#extending-wxf-parsing-writing-a-wxfconsumer" title="Permalink to this headline">¶</a></h2>
<div class="section" id="integer-eigenvalues">
<h3>Integer Eigenvalues<a class="headerlink" href="#integer-eigenvalues" title="Permalink to this headline">¶</a></h3>
<p>Use the Wolfram Client Library to access the Wolfram Language algebra functions. Compute the integer <a class="wl external reference" href="http://reference.wolfram.com/language/ref/Eigenvalues.html" target="_blank">Eigenvalues</a> on a Python matrix of integers:</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">wolframclient.evaluation</span> <span class="k">import</span> <span class="n">WolframLanguageSession</span>
<span class="kn">from</span> <span class="nn">wolframclient.language</span> <span class="k">import</span> <span class="n">wl</span>

<span class="c1"># Change the path to point to a local kernel. </span>
<span class="c1"># This value corresponds to the default path to a MacOS Wolfram Desktop kernel.</span>
<span class="n">kernel_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Wolfram Desktop.app/Contents/MacOS/WolframKernel&#39;</span>

<span class="k">with</span> <span class="n">WolframLanguageSession</span><span class="p">(</span><span class="n">kernel_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="c1"># define a matrix of integers</span>
<span class="hll">    <span class="n">array</span> <span class="o">=</span> <span class="p">[</span>
</span><span class="hll">        <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
</span><span class="hll">        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> 
</span><span class="hll">        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
</span>    <span class="c1"># expression to evaluate</span>
<span class="hll">    <span class="n">expr</span> <span class="o">=</span> <span class="n">wl</span><span class="o">.</span><span class="n">Eigenvalues</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span>    <span class="c1"># send expression to the kernel for evaluation.</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>  <span class="c1"># [-2, -2, 1]</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="complex-eigenvalues">
<span id="complex-consumer"></span><h3>Complex Eigenvalues<a class="headerlink" href="#complex-eigenvalues" title="Permalink to this headline">¶</a></h3>
<p>Python has built-in <a class="reference external" href="https://docs.python.org/3/library/functions.html#complex" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">complex</span></code></a>. By default, the function <a class="reference internal" href="../api/wolframclient.deserializers.html#wolframclient.deserializers.binary_deserialize" title="wolframclient.deserializers.binary_deserialize"><code class="xref py py-func docutils literal notranslate"><span class="pre">binary_deserialize()</span></code></a> deserializes Wolfram Language functions using a generic class <a class="reference internal" href="../api/wolframclient.language.html#wolframclient.language.expression.WLFunction" title="wolframclient.language.expression.WLFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">WLFunction</span></code></a>, but conveniently provides a way to extend the mapping. Define <cite>ComplexFunctionConsumer</cite>, a subclass of <a class="reference internal" href="../api/wolframclient.deserializers.html#wolframclient.deserializers.WXFConsumer" title="wolframclient.deserializers.WXFConsumer"><code class="xref py py-class docutils literal notranslate"><span class="pre">WXFConsumer</span></code></a> that overrides the method <a class="reference internal" href="../api/wolframclient.deserializers.html#wolframclient.deserializers.WXFConsumer.build_function" title="wolframclient.deserializers.WXFConsumer.build_function"><code class="xref py py-meth docutils literal notranslate"><span class="pre">build_function()</span></code></a>. The subclassed method maps <a class="wl external reference" href="http://reference.wolfram.com/language/ref/Complex.html" target="_blank">Complex</a> to the built-in Python complex.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">wolframclient.evaluation</span> <span class="k">import</span> <span class="n">WolframLanguageSession</span>
<span class="kn">from</span> <span class="nn">wolframclient.language</span> <span class="k">import</span> <span class="n">wl</span>
<span class="kn">from</span> <span class="nn">wolframclient.deserializers</span> <span class="k">import</span> <span class="n">WXFConsumer</span><span class="p">,</span> <span class="n">binary_deserialize</span>

<span class="c1"># TODO: Change this value with a valid local path to a Wolfram Kernel.</span>
<span class="n">kernel_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Wolfram Desktop.app/Contents/MacOS/WolframKernel&#39;</span>


<span class="hll"><span class="k">class</span> <span class="nc">ComplexFunctionConsumer</span><span class="p">(</span><span class="n">WXFConsumer</span><span class="p">):</span>
</span><span class="hll">    <span class="sd">&quot;&quot;&quot;Implement a consumer that maps Complex to python complex types.&quot;&quot;&quot;</span>
</span><span class="hll">    
</span><span class="hll">    <span class="c1"># represent the symbol Complex as a Python class</span>
</span><span class="hll">    <span class="n">Complex</span> <span class="o">=</span> <span class="n">wl</span><span class="o">.</span><span class="n">Complex</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">build_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="hll">        <span class="c1"># return a built in complex if head is Complex and argument length is 2.</span>
</span><span class="hll">        <span class="k">if</span> <span class="n">head</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">Complex</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span class="hll">            <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span class="hll">        <span class="c1"># otherwise delegate to the super method (default case).</span>
</span><span class="hll">        <span class="k">else</span><span class="p">:</span>
</span><span class="hll">            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_function</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span>
<span class="k">with</span> <span class="n">WolframLanguageSession</span><span class="p">(</span><span class="n">kernel_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> 
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
    <span class="c1"># expression to evaluate</span>
    <span class="n">expr</span> <span class="o">=</span> <span class="n">wl</span><span class="o">.</span><span class="n">Eigenvalues</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="c1"># send expression to the kernel for evaluation.</span>
    <span class="n">wxf</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">evaluate_wxf</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="c1"># get the WXF bytes and parse them using the complex consumer:</span>
    <span class="n">complex_result</span> <span class="o">=</span> <span class="n">binary_deserialize</span><span class="p">(</span>
        <span class="n">wxf</span><span class="p">,</span> 
<span class="hll">        <span class="n">consumer</span><span class="o">=</span><span class="n">ComplexFunctionConsumer</span><span class="p">())</span>
</span>    <span class="nb">print</span><span class="p">(</span><span class="n">complex_result</span><span class="p">)</span>  <span class="c1"># [2j, -2j, 0]</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="symbolic-eigenvalues">
<h3>Symbolic Eigenvalues<a class="headerlink" href="#symbolic-eigenvalues" title="Permalink to this headline">¶</a></h3>
<div class="section" id="a-python-heavy-approach">
<h4>A Python-Heavy Approach<a class="headerlink" href="#a-python-heavy-approach" title="Permalink to this headline">¶</a></h4>
<p>Sometimes the resulting expression of an evaluation is a symbolic exact value, which nonetheless could be approximated to a numerical result. The eigenvalues of <span class="math notranslate nohighlight">\(\begin{pmatrix} \pi &amp; -2 &amp; 0 \\ 1 &amp; \pi &amp; -1 \\ 0 &amp; 2 &amp; \pi \\ \end{pmatrix}\)</span> are <span class="math notranslate nohighlight">\(\frac{1}{2}(4I+2\pi)\)</span>, <span class="math notranslate nohighlight">\(\frac{1}{2}(-4I+2\pi)\)</span> and <span class="math notranslate nohighlight">\(\pi\)</span>.</p>
<p>It is possible to build a subclass of <a class="reference internal" href="../api/wolframclient.deserializers.html#wolframclient.deserializers.WXFConsumer" title="wolframclient.deserializers.WXFConsumer"><code class="xref py py-class docutils literal notranslate"><span class="pre">WXFConsumer</span></code></a> that can convert a subset of all Wolfram Language symbols into pure built-in Python objects. It has to deal with <a class="wl external reference" href="http://reference.wolfram.com/language/ref/Plus.html" target="_blank">Plus</a> and <a class="wl external reference" href="http://reference.wolfram.com/language/ref/Times.html" target="_blank">Times</a>, converts <a class="wl external reference" href="http://reference.wolfram.com/language/ref/Pi.html" target="_blank">Pi</a> to <code class="xref py py-class docutils literal notranslate"><span class="pre">math.pi</span></code>, <a class="wl external reference" href="http://reference.wolfram.com/language/ref/Rational.html" target="_blank">Rational</a> to <a class="reference external" href="https://docs.python.org/3/library/fractions.html#fractions.Fraction" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">fractions.Fraction</span></code></a> and <a class="wl external reference" href="http://reference.wolfram.com/language/ref/Complex.html" target="_blank">Complex</a> to <a class="reference external" href="https://docs.python.org/3/library/functions.html#complex" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">complex</span></code></a>. It results in a significant code inflation but provide a detailed review of the extension mechanism. However, as will be shown, this is not really necessary.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">wolframclient.evaluation</span> <span class="k">import</span> <span class="n">WolframLanguageSession</span>
<span class="kn">from</span> <span class="nn">wolframclient.language</span> <span class="k">import</span> <span class="n">wl</span>
<span class="kn">from</span> <span class="nn">wolframclient.deserializers</span> <span class="k">import</span> <span class="n">WXFConsumer</span><span class="p">,</span> <span class="n">binary_deserialize</span>

<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">fractions</span>

<span class="c1"># TODO: Change this value with a valid local path to a Wolfram Kernel.</span>
<span class="n">kernel_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Wolfram Desktop.app/Contents/MacOS/WolframKernel&#39;</span>

<span class="c1"># define Complex symbol once and for all</span>
<span class="n">Complex</span> <span class="o">=</span> <span class="n">wl</span><span class="o">.</span><span class="n">Complex</span>

<span class="hll"><span class="k">class</span> <span class="nc">MathConsumer</span><span class="p">(</span><span class="n">WXFConsumer</span><span class="p">):</span>
</span><span class="hll">    <span class="sd">&quot;&quot;&quot;Implement a consumer with basic arithmetic operation.&quot;&quot;&quot;</span>
</span><span class="hll">    
</span><span class="hll">    <span class="c1"># Specific convertion for Pi, other symbols use the default method.</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">consume_symbol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_token</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="hll">        <span class="c1"># Convert symbol Pi to its numeric value as defined in Python</span>
</span><span class="hll">        <span class="k">if</span> <span class="n">current_token</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="s1">&#39;Pi&#39;</span><span class="p">:</span>
</span><span class="hll">            <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">pi</span>
</span><span class="hll">        <span class="k">else</span><span class="p">:</span>
</span><span class="hll">            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">consume_symbol</span><span class="p">(</span><span class="n">current_token</span><span class="p">,</span> <span class="n">tokens</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="c1"># Associate heads with the method to convert them to Python types.</span>
</span><span class="hll">    <span class="n">DISPATCH</span> <span class="o">=</span> <span class="p">{</span>
</span><span class="hll">        <span class="n">Complex</span><span class="p">:</span> <span class="s1">&#39;build_complex&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="n">wl</span><span class="o">.</span><span class="n">Rational</span><span class="p">:</span> <span class="s1">&#39;build_rational&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="n">wl</span><span class="o">.</span><span class="n">Plus</span><span class="p">:</span> <span class="s1">&#39;build_plus&#39;</span><span class="p">,</span>
</span><span class="hll">        <span class="n">wl</span><span class="o">.</span><span class="n">Times</span><span class="p">:</span> <span class="s1">&#39;build_times&#39;</span>
</span><span class="hll">    <span class="p">}</span>
</span><span class="hll">    <span class="c1"># Overload the method that builds functions. </span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">build_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="hll">        <span class="c1"># check if there is a specific function associated to the function head</span>
</span><span class="hll">        <span class="n">builder_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DISPATCH</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span class="hll">        <span class="k">if</span> <span class="n">builder_func</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span class="hll">            <span class="k">try</span><span class="p">:</span>
</span><span class="hll">                <span class="c1"># get the class method and apply it to the arguments.</span>
</span><span class="hll">                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">builder_func</span><span class="p">)(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span class="hll">            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span class="hll">                <span class="c1"># instead of failing, fallback to default case.</span>
</span><span class="hll">                <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_function</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class="hll">        <span class="c1"># heads not listed in DISPATCH are delegated to parent&#39;s method</span>
</span><span class="hll">        <span class="k">else</span><span class="p">:</span>
</span><span class="hll">            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_function</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">build_plus</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span class="hll">        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span class="hll">            <span class="n">total</span> <span class="o">=</span> <span class="n">total</span> <span class="o">+</span> <span class="n">arg</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">total</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">build_times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span class="hll">        <span class="n">total</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class="hll">        <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span class="hll">            <span class="n">total</span> <span class="o">=</span> <span class="n">total</span> <span class="o">*</span> <span class="n">arg</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">total</span>
</span><span class="hll">
</span><span class="hll">    <span class="k">def</span> <span class="nf">build_rational</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span class="hll">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span class="hll">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Rational format not supported.&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">fractions</span><span class="o">.</span><span class="n">Fraction</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span class="hll">    
</span><span class="hll">    <span class="k">def</span> <span class="nf">build_complex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span class="hll">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span class="hll">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Complex format not supported.&#39;</span><span class="p">)</span>
</span><span class="hll">        <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span>
<span class="k">with</span> <span class="n">WolframLanguageSession</span><span class="p">(</span><span class="n">kernel_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">wl</span><span class="o">.</span><span class="n">Pi</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">wl</span><span class="o">.</span><span class="n">Pi</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">wl</span><span class="o">.</span><span class="n">Pi</span><span class="p">]]</span>

    <span class="c1"># expression to evaluate: Eigenvalues[array]</span>
    <span class="n">expr</span> <span class="o">=</span> <span class="n">wl</span><span class="o">.</span><span class="n">Eigenvalues</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

    <span class="c1"># Eigenvalues are exact, but the result is a symbolic expression:</span>
    <span class="c1"># [Times[Rational[1, 2], Plus[Complex[0, 4], Times[2, Pi]]], </span>
    <span class="c1"># Times[Rational[1, 2], Plus[Complex[0, -4], Times[2, Pi]]], Pi]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
    
    <span class="c1"># Use evaluate_wxf to evaluate without deserializing the result.</span>
    <span class="n">wxf</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">evaluate_wxf</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="c1"># deserialize  using the math consumer:</span>
<span class="hll">    <span class="n">complex_result</span> <span class="o">=</span> <span class="n">binary_deserialize</span><span class="p">(</span><span class="n">wxf</span><span class="p">,</span> <span class="n">consumer</span><span class="o">=</span><span class="n">MathConsumer</span><span class="p">())</span>
</span>    <span class="c1"># get a numerical result, only made of built-in Python types.</span>
    <span class="c1"># [(3.141592653589793+2j), (3.141592653589793-2j), 3.141592653589793]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">complex_result</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="a-wolfram-language-alternative">
<h4>A Wolfram Language Alternative<a class="headerlink" href="#a-wolfram-language-alternative" title="Permalink to this headline">¶</a></h4>
<p>It is recommended to delegate as much as possible to the Wolfram Language. Instead of implementing a (fragile) counterpart of core functions such as <a class="wl external reference" href="http://reference.wolfram.com/language/ref/Plus.html" target="_blank">Plus</a> or <a class="wl external reference" href="http://reference.wolfram.com/language/ref/Times.html" target="_blank">Times</a>, it is best to compute a numerical result within the kernel. This can be achieved with the function <a class="wl external reference" href="http://reference.wolfram.com/language/ref/N.html" target="_blank">N</a>. Once applied to the eigenvalues the result becomes a mixture of complex values and reals, which was already dealt with in the <a class="reference internal" href="#complex-consumer"><span class="std std-ref">previous section</span></a>.</p>
<div class="highlight-default notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="kn">from</span> <span class="nn">wolframclient.evaluation</span> <span class="k">import</span> <span class="n">WolframLanguageSession</span>
<span class="kn">from</span> <span class="nn">wolframclient.language</span> <span class="k">import</span> <span class="n">wl</span>
<span class="kn">from</span> <span class="nn">wolframclient.deserializers</span> <span class="k">import</span> <span class="n">WXFConsumer</span><span class="p">,</span> <span class="n">binary_deserialize</span>

<span class="c1"># TODO: Change this value with a valid local path to a Wolfram Kernel.</span>
<span class="n">kernel_path</span> <span class="o">=</span> <span class="s1">&#39;/Applications/Wolfram Desktop.app/Contents/MacOS/WolframKernel&#39;</span>

<span class="c1"># represent the symbol Complex as a Python class</span>
<span class="n">Complex</span> <span class="o">=</span> <span class="n">wl</span><span class="o">.</span><span class="n">Complex</span>

<span class="hll"><span class="k">class</span> <span class="nc">ComplexFunctionConsumer</span><span class="p">(</span><span class="n">WXFConsumer</span><span class="p">):</span>
</span><span class="hll">    <span class="sd">&quot;&quot;&quot;Implement a consumer that maps Complex to python complex types.&quot;&quot;&quot;</span>
</span><span class="hll">    <span class="k">def</span> <span class="nf">build_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class="hll">        <span class="k">if</span> <span class="n">head</span> <span class="o">==</span> <span class="n">Complex</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span class="hll">            <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
</span><span class="hll">        <span class="k">else</span><span class="p">:</span>
</span><span class="hll">            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_function</span><span class="p">(</span><span class="n">head</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span>
<span class="k">with</span> <span class="n">WolframLanguageSession</span><span class="p">(</span><span class="n">kernel_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">[</span><span class="n">wl</span><span class="o">.</span><span class="n">Pi</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">wl</span><span class="o">.</span><span class="n">Pi</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">wl</span><span class="o">.</span><span class="n">Pi</span><span class="p">]]</span>

    <span class="c1"># expression to evaluate: N[EigenValues[array]]</span>
    <span class="n">expr</span> <span class="o">=</span> <span class="n">wl</span><span class="o">.</span><span class="n">N</span><span class="p">(</span><span class="n">wl</span><span class="o">.</span><span class="n">Eigenvalues</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>
    
    <span class="c1"># evaluate without deserializing</span>
    <span class="n">wxf</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">evaluate_wxf</span><span class="p">(</span><span class="n">expr</span><span class="p">)</span>
    <span class="c1"># deserialize using the math consumer:</span>
<span class="hll">    <span class="n">complex_result</span> <span class="o">=</span> <span class="n">binary_deserialize</span><span class="p">(</span><span class="n">wxf</span><span class="p">,</span> <span class="n">consumer</span><span class="o">=</span><span class="n">ComplexFunctionConsumer</span><span class="p">())</span>
</span>    <span class="c1"># [(3.141592653589793+2j), (3.141592653589793-2j), 3.141592653589793]</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">complex_result</span><span class="p">)</span>
</pre></div>
</td></tr></table></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">

    <a href="../index.html">
        <img class="logo" src="../_static/python-client-library-logo.png" title="https://www.wolfram.com/" />
    </a>


  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Advanced Usage and Code Examples</a><ul>
<li><a class="reference internal" href="#expression-representation">Expression Representation</a><ul>
<li><a class="reference internal" href="#contexts">Contexts</a><ul>
<li><a class="reference internal" href="#system-context"><code class="docutils literal notranslate"><span class="pre">System`</span></code> Context</a></li>
<li><a class="reference internal" href="#global-context"><code class="docutils literal notranslate"><span class="pre">Global`</span></code> Context</a></li>
<li><a class="reference internal" href="#arbitrary-contexts">Arbitrary Contexts</a></li>
<li><a class="reference internal" href="#use-case">Use Case</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#local-kernel-evaluation">Local Kernel Evaluation</a><ul>
<li><a class="reference internal" href="#evaluation-methods">Evaluation Methods</a><ul>
<li><a class="reference internal" href="#synchronous">Synchronous</a></li>
<li><a class="reference internal" href="#asynchronous">Asynchronous</a><ul>
<li><a class="reference internal" href="#concurrent-future-api">Concurrent Future API</a></li>
<li><a class="reference internal" href="#coroutine-and-asyncio-apis">Coroutine and Asyncio APIs</a></li>
<li><a class="reference internal" href="#kernel-pool">Kernel Pool</a></li>
<li><a class="reference internal" href="#parallel-evaluate">parallel_evaluate</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#logging">Logging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#extending-wxf-parsing-writing-a-wxfconsumer">Extending WXF Parsing: Writing a WXFConsumer</a><ul>
<li><a class="reference internal" href="#integer-eigenvalues">Integer Eigenvalues</a></li>
<li><a class="reference internal" href="#complex-eigenvalues">Complex Eigenvalues</a></li>
<li><a class="reference internal" href="#symbolic-eigenvalues">Symbolic Eigenvalues</a><ul>
<li><a class="reference internal" href="#a-python-heavy-approach">A Python-Heavy Approach</a></li>
<li><a class="reference internal" href="#a-wolfram-language-alternative">A Wolfram Language Alternative</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="intro.html"
                        title="previous chapter">Introduction to the Wolfram Client Library</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="public_api.html"
                        title="next chapter">API: Guide</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/docpages/advanced_usages.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="public_api.html" title="API: Guide"
             >next</a> |</li>
        <li class="right" >
          <a href="intro.html" title="Introduction to the Wolfram Client Library"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Wolfram Client Library for Python 1.0.0.dev3 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Wolfram Research.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.1.
    </div>
  </body>
</html>